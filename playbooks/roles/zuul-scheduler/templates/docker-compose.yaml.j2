# Version 2 is the latest that is supported by docker-compose in
# Ubuntu Xenial.
version: '2'

services:
  scheduler:
    environment:
      no_proxy: "${no_proxy}"
    command: "zuul-scheduler -d"
    image: progmaticlab/zuul-scheduler:2.5.3
    ports:
      - "4730:4730"
      - "8001:8001"
    volumes:
      - "./etc_zuul:/etc/zuul"
      - "./ssh_keys:/var/ssh"
      - "./.ssh:/root/.ssh"
      - "/var/log/zuul:/var/log/zuul"
      - "/var/lib/zuul:/var/lib/zuul"
      - "/var/run:/var/run"
      - "/etc/localtime:/etc/localtime:ro"
      - "/etc/timezone:/etc/timezone:ro"
  logs:
    build:
      dockerfile: logs-Dockerfile
      context: ./
      args:
        http_proxy: "${http_proxy}"
        https_proxy: "${http_proxy}"
        no_proxy: "${no_proxy}"
    ports:
      - "{{ zuul_logs_port }}:80"
    volumes:
      - "/var/www/logs:/usr/local/apache2/htdocs"
